<!DOCTYPE html><html>
        <head>
        <title>cmsimde_site</title>
        <meta charset="utf-8">
<meta property="head" content="H2">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <!-- for Wink3 -->
        <link rel="stylesheet" type="text/css" href="./../cmsimde/static/winkPlayer.css" />
        <script type="text/javascript" src="./../cmsimde/static/winkPlayer.js"></script>
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushRust.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container-fluid'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container-fluid">
                <div class="row align-items-center">
                <h1>cmsimde_site</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">cmsimde_site</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li><a href='About.html'>About</a><li><a href='online.html'>online</a><li><a href='w3.html'>w3</a><li class='has-children'><a href='midterm.html'>midterm</a><ul class='dropdown'><li><a href='模擬影片.html'>模擬影片</a><li><a href='M3X6 内六角圆头螺丝.html'>M3X6 内六角圆头螺丝</a><li><a href='M3X15.html'>M3X15</a><li><a href='M4X5.html'>M4X5</a><li><a href='M4X6.html'>M4X6</a><li><a href='M4X7.html'>M4X7</a><li><a href='M4X15.html'>M4X15</a></li></ul><li><a href='run.html'>run</a><li class='has-children'><a href='W10.html'>W10</a><ul class='dropdown'><li><a href='w10_block_ui.html'>w10_block_ui</a><li><a href='w10_nx_integ.html'>w10_nx_integ</a><li><a href='w10_ssh.html'>w10_ssh</a></li></ul><li class='has-children'><a href='W12.html'>W12</a><ul class='dropdown'><li><a href='w12 txt.html'>w12 txt</a></li></ul><li class='has-children'><a href='W13.html'>W13</a><ul class='dropdown'><li><a href='STL.html'>STL</a><li><a href='控制碼.html'>控制碼</a><li><a href='樹狀圖.html'>樹狀圖</a><li><a href='心得.html'>心得</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">STL << <a href='STL.html'>Previous</a> <a href='樹狀圖.html'>Next</a> >> 樹狀圖<br /><h1>控制碼</h1>
<p><a href="./../downloads/程式碼.txt">/downloads/程式碼.txt</a></p>
<p>function sysCall_init()<br/> -- Check if the required plugin (simExtMTB.dll) is there:<br/> moduleName=0<br/> moduleVersion=0<br/> index=0<br/> MTBModuleFound=false<br/> while moduleName do<br/> moduleName,moduleVersion=sim.getModuleName(index)<br/> if (moduleName=='MTB') then<br/> MTBModuleFound=true<br/> end<br/> index=index+1<br/> end<br/> if (MTBModuleFound==false) then<br/> sim.addLog(sim.verbosity_scripterrors,'\'MTB\' plugin was not found. (simExtMTB.dll, libsimExtMTB.dylib or libsimExtMTB.so). Simulation will not run properly')<br/> end<br/> -- Get some object handles that are required later:<br/> robotHandle=sim.getObject('.')<br/> jointHandles={-1,-1,-1,-1}<br/> for i=1,4,1 do<br/> jointHandles[i]=sim.getObject('./axis',{index=i-1})<br/> end<br/> robotName=sim.getObjectAlias(sim.getObject('.'),1)<br/> collisionMessageID=-1<br/> compilErrorMessageID=-1<br/> dfltButProp=sim.buttonproperty_button+sim.buttonproperty_horizontallycentered+sim.buttonproperty_staydown+sim.buttonproperty_verticallycentered<br/> jointPositions={0,0,0,0}<br/> for i=1,4,1 do<br/> jointPositions[i]=sim.getJointPosition(jointHandles[i]) -- the initial joint positions<br/> end<br/> restarting=false<br/> cmdMessage=''<br/> robotProgramExecutionState=1 -- 0 is stopped, 1 is executing, 2 is paused<br/> -- Now start the server:<br/> serverHandle=startRobotServer(robotHandle,program,{0,0,0,0},{0.1,0.4})<br/>end</p>
<p>program=[[REM ************************************************<br/>REM This is a very very simple robot language EXAMPLE!<br/>REM Following commands are supported (one command per line):<br/>REM -"REM" starts a comment line<br/>REM -"SETROTVEL v": sets the revolute joint velocity for next movements (in degrees/s)<br/>REM -"SETLINVEL v": sets the prismatic joint velocity for next movements (in meters/s)<br/>REM -"MOVE p1 p2 p3 p4": moves to joint positions (p1;p2;p3;p4) (in degrees or meter)<br/>REM -"WAIT x": waits x miliseconds<br/>REM -"SETBIT y": sets the bit at pos y in the output buffer<br/>REM -"CLEARBIT y": clears the bit at pos y in the output buffer<br/>REM -"IFBITGOTO y label": jumps to "label" position if bit at pos y is set in the input buffer<br/>REM -"IFNBITGOTO y label": jumps to "label" position if bit at pos y is not set in the input buffer<br/>REM -"GOTO label": jumps to "label" position<br/>REM any not recognized word is considered to be a label<br/>REM ************************************************<br/>SETROTVEL 45<br/>SETLINVEL 0.1<br/>MOVE 0 0 0 0<br/>PROGRAM_BEGIN_LABEL<br/>MOVE 0 0 0.03 0<br/>IFBITGOTO 1 LABEL1<br/>SETBIT 1<br/>LABEL1<br/>WAIT 500<br/>MOVE 0 0 0 0<br/>WAIT 250<br/>MOVE -160 -43.5 0 203.5<br/>WAIT 250<br/>MOVE -160 -43.5 0.03 203.5<br/>CLEARBIT 1<br/>WAIT 500<br/>MOVE -160 -43.5 0 203.5<br/>WAIT 250<br/>MOVE 160 43.5 0 -203.5<br/>WAIT 250<br/>MOVE 160 43.5 0.03 -203.5<br/>IFBITGOTO 1 LABEL2<br/>SETBIT 1<br/>LABEL2<br/>WAIT 500<br/>MOVE 160 43.5 0 -203.5<br/>GOTO LABEL1<br/>]]</p>
<p>-- ***********************************************************************************************************************<br/>-- ***********************************************************************************************************************<br/>-- ***********************************************************************************************************************<br/>-- This script makes the link between the MTB robot and the simExtMtb.dll plugin. This script could be much<br/>-- shorter and simple, if everything was taken care of in the plugin. The advantage of handling many things here<br/>-- is that if something needs to be changed, the plugin doesn't require to be recompiled<br/>-- Following commands are registered by the MTB plugin:<br/>--<br/>-- number serverHandle,string msg=simMTB.startServer(string serverExecutable,number connectionPort,string programData,table_4 jointValues,table_2 initialJointVelocity)<br/>-- Starts a robot server, and compiles the program. If result&gt;=0, the call was successful. Otherwise msg contains a compilation error message<br/>--<br/>-- boolean result=simMTB.stopServer(number serverHandle)<br/>-- Stops a robot server<br/>--<br/>-- number result,string info=simMTB.step(number serverHandle,number deltaTime)<br/>-- runs the robot language interpreter for deltaTime. if result==0, the program is running, if result==1 the program ended. Any other value means an error<br/>--<br/>-- table_4 jointValues=simMTB.getJoints(number serverHandle)<br/>-- returns the values of the robot's 4 axis<br/>--<br/>-- table_4 outputValues=simMTB.getOutput(number serverHandle)<br/>-- returns the 32 bits (4*8) of the robot's outputs<br/>--<br/>-- table_4 inputValues=simMTB.getInput(number serverHandle)<br/>-- returns the 32 bits (4*8) of the robot's inputs<br/>--<br/>-- number result=simMTB.setInput(number serverHandle,table_4 inputValues)<br/>-- writes the 32 bits (4*8) of the robot's inputs<br/>--<br/>-- boolean result=simMTB.connectInput(number inputServerHandle,number inputBitNumber,number outputServerHandle,number outputBitNumber,number connectionType)<br/>-- connects a robot's output bit to another robot's input bit. If connectionType~=0 the connection line invertes the bit state<br/>--<br/>-- boolean result=simMTB.disconnectInput(number inputServerHandle,number inputBitNumber)<br/>-- disconnects a connection previously done with simMTB.connectInput<br/>--<br/>-- ***********************************************************************************************************************<br/>-- ***********************************************************************************************************************<br/>-- ***********************************************************************************************************************</p>
<p>function displayUiIfNeeded()<br/> local objs=sim.getObjectSelection()<br/> if objs~=nil and objs[#objs]==robotHandle then<br/> createUi()<br/> else<br/> removeUi()<br/> end<br/>end</p>
<p>function createUi()<br/> if ui==nil then<br/> local xml = '&lt;ui title="'..sim.getObjectAlias(robotHandle,1)..'" closeable="false" resizeable="false" activate="false" placement="relative" position="-50,50"&gt;'..[[<br/> &lt;tabs&gt;<br/> &lt;tab title="Command"&gt;<br/> &lt;group layout="hbox" flat="true"&gt;<br/> &lt;button text="Start/Restart" on-click="start_callback" id="1"/&gt;<br/> &lt;button text="Pause" on-click="pause_callback" id="2"/&gt;<br/> &lt;button text="Stop" on-click="stop_callback" id="3"/&gt;<br/> &lt;/group&gt;<br/> &lt;group layout="form" flat="true"&gt;<br/> &lt;label text="Command" /&gt;<br/> &lt;edit id="4" enabled="false"/&gt;<br/> &lt;/group&gt;<br/> &lt;/tab&gt;<br/> &lt;tab title="Joints"&gt;<br/> &lt;group layout="form" flat="true"&gt;<br/> &lt;label text="Joint 1" /&gt;<br/> &lt;edit id="11" enabled="false"/&gt;<br/> &lt;label text="Joint 2" /&gt;<br/> &lt;edit id="12" enabled="false"/&gt;<br/> &lt;label text="Joint 3" /&gt;<br/> &lt;edit id="13" enabled="false"/&gt;<br/> &lt;label text="Joint 4" /&gt;<br/> &lt;edit id="14" enabled="false"/&gt;<br/> &lt;/group&gt;<br/> &lt;/tab&gt;<br/> &lt;tab title="Input"&gt;<br/> &lt;group layout="grid" flat="true"&gt;<br/> &lt;label text="" /&gt;<br/> &lt;label text="1" /&gt;<br/> &lt;label text="2" /&gt;<br/> &lt;label text="3" /&gt;<br/> &lt;label text="4" /&gt;<br/> &lt;label text="5" /&gt;<br/> &lt;label text="6" /&gt;<br/> &lt;label text="7" /&gt;<br/> &lt;label text="8" /&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+00" /&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="101"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="102"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="103"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="104"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="105"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="106"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="107"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="108"/&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+08" /&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="109"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="110"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="111"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="112"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="113"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="114"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="115"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="116"/&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+16" /&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="117"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="118"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="119"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="120"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="121"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="122"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="123"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="124"/&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+24" /&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="125"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="126"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="127"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="128"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="129"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="130"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="131"/&gt;<br/> &lt;checkbox text="" on-change="inputClicked_callback" id="132"/&gt;<br/> &lt;/group&gt;<br/> &lt;/tab&gt;<br/> &lt;tab title="Output"&gt;<br/> &lt;group layout="grid" flat="true"&gt;<br/> &lt;label text="" /&gt;<br/> &lt;label text="1" /&gt;<br/> &lt;label text="2" /&gt;<br/> &lt;label text="3" /&gt;<br/> &lt;label text="4" /&gt;<br/> &lt;label text="5" /&gt;<br/> &lt;label text="6" /&gt;<br/> &lt;label text="7" /&gt;<br/> &lt;label text="8" /&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+00" /&gt;<br/> &lt;checkbox text="" enabled="false" id="201"/&gt;<br/> &lt;checkbox text="" enabled="false" id="202"/&gt;<br/> &lt;checkbox text="" enabled="false" id="203"/&gt;<br/> &lt;checkbox text="" enabled="false" id="204"/&gt;<br/> &lt;checkbox text="" enabled="false" id="205"/&gt;<br/> &lt;checkbox text="" enabled="false" id="206"/&gt;<br/> &lt;checkbox text="" enabled="false" id="207"/&gt;<br/> &lt;checkbox text="" enabled="false" id="208"/&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+08" /&gt;<br/> &lt;checkbox text="" enabled="false" id="209"/&gt;<br/> &lt;checkbox text="" enabled="false" id="210"/&gt;<br/> &lt;checkbox text="" enabled="false" id="211"/&gt;<br/> &lt;checkbox text="" enabled="false" id="212"/&gt;<br/> &lt;checkbox text="" enabled="false" id="213"/&gt;<br/> &lt;checkbox text="" enabled="false" id="214"/&gt;<br/> &lt;checkbox text="" enabled="false" id="215"/&gt;<br/> &lt;checkbox text="" enabled="false" id="216"/&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+16" /&gt;<br/> &lt;checkbox text="" enabled="false" id="217"/&gt;<br/> &lt;checkbox text="" enabled="false" id="218"/&gt;<br/> &lt;checkbox text="" enabled="false" id="219"/&gt;<br/> &lt;checkbox text="" enabled="false" id="220"/&gt;<br/> &lt;checkbox text="" enabled="false" id="221"/&gt;<br/> &lt;checkbox text="" enabled="false" id="222"/&gt;<br/> &lt;checkbox text="" enabled="false" id="223"/&gt;<br/> &lt;checkbox text="" enabled="false" id="224"/&gt;<br/> &lt;br/&gt;<br/> &lt;label text="+24" /&gt;<br/> &lt;checkbox text="" enabled="false" id="225"/&gt;<br/> &lt;checkbox text="" enabled="false" id="226"/&gt;<br/> &lt;checkbox text="" enabled="false" id="227"/&gt;<br/> &lt;checkbox text="" enabled="false" id="228"/&gt;<br/> &lt;checkbox text="" enabled="false" id="229"/&gt;<br/> &lt;checkbox text="" enabled="false" id="230"/&gt;<br/> &lt;checkbox text="" enabled="false" id="231"/&gt;<br/> &lt;checkbox text="" enabled="false" id="232"/&gt;<br/> &lt;/group&gt;<br/> &lt;/tab&gt;<br/> &lt;/tabs&gt;<br/> &lt;/ui&gt;<br/> ]]<br/> ui=simUI.create(xml)<br/> end<br/>end</p>
<p>function removeUi()<br/> if ui then<br/> simUI.destroy(ui)<br/> ui=nil<br/> end<br/>end</p>
<p>function updateUiIfNeeded()<br/> if ui then<br/> -- Update the main custom dialog:<br/> -- The "run" button:<br/> simUI.setEnabled(ui,1,robotProgramExecutionState~=1)<br/> -- The "pause" button:<br/> simUI.setEnabled(ui,2,robotProgramExecutionState==1)<br/> -- The "stop" button:<br/> simUI.setEnabled(ui,3,robotProgramExecutionState~=0)<br/> -- The command label:<br/> simUI.setEditValue(ui,4,cmdMessage)<br/> -- The joint labels:<br/> simUI.setEditValue(ui,11,string.format('%.2f',jointPositions[1]*180/math.pi))<br/> simUI.setEditValue(ui,12,string.format('%.2f',jointPositions[2]*180/math.pi))<br/> simUI.setEditValue(ui,13,string.format('%.4f',jointPositions[3]))<br/> simUI.setEditValue(ui,14,string.format('%.2f',jointPositions[4]*180/math.pi))<br/> <br/> -- Update (read and write) the IN/OUT custom dialog:<br/> if MTBModuleFound then<br/> for i=0,3,1 do<br/> for j=0,7,1 do<br/> if ((inputData[1+i]&amp;(2^j))~=0) then<br/> simUI.setCheckboxValue(ui,101+j+i*8,2)<br/> else<br/> simUI.setCheckboxValue(ui,101+j+i*8,0)<br/> end<br/> if ((outputData[1+i]&amp;(2^j))~=0) then<br/> simUI.setCheckboxValue(ui,201+j+i*8,2)<br/> else<br/> simUI.setCheckboxValue(ui,201+j+i*8,0)<br/> end<br/> end<br/> end<br/> end<br/> end<br/>end</p>
<p>startRobotServer=function(theRobotHandle,theProgram,initJoints,initVel)<br/> -- Find a (hopefully) free port:<br/> local portNb=sim.getInt32Param(sim.intparam_server_port_next)<br/> local portStart=sim.getInt32Param(sim.intparam_server_port_start)<br/> local portRange=sim.getInt32Param(sim.intparam_server_port_range)<br/> local newPortNb=portNb+1<br/> if (newPortNb&gt;=portStart+portRange) then<br/> newPortNb=portStart<br/> end<br/> sim.setInt32Param(sim.intparam_server_port_next,newPortNb)<br/> -- Start the server:<br/> local serverHandle,errorMsg=simMTB.startServer('mtbServer',portNb,theProgram,initJoints,initVel)<br/> if serverHandle&lt;0 then<br/> -- We have a problem. Display the message:<br/> sim.addLog(sim.verbosity_scripterrors,'Robot \''..robotName..'\' caused a program compilation error: '..errorMsg)<br/> end<br/> -- Now write the server handle to the robot object, so that other objects can access that handle too:<br/> sim.writeCustomDataBlock(theRobotHandle,'@tmpMTBSERVERHANDLE',sim.packInt32Table({serverHandle}))<br/> return serverHandle<br/>end</p>
<p>function start_callback()<br/> -- "Run" was pressed<br/> if (robotProgramExecutionState==0) then<br/> robotProgramExecutionState=1<br/> else<br/> if (robotProgramExecutionState==2) then robotProgramExecutionState=1 end<br/> end<br/>end</p>
<p>function pause_callback()<br/> -- "Pause" was pressed<br/> if (robotProgramExecutionState==1) then robotProgramExecutionState=2 end<br/>end</p>
<p>function stop_callback()<br/> -- "Stop" was pressed<br/> if (robotProgramExecutionState~=0) then<br/> robotProgramExecutionState=0<br/> restarting=true<br/> cmdMessage=''<br/> end<br/>end</p>
<p>function inputClicked_callback(ui,id,newVal)<br/> inputData[1+math.floor((id-101)/8)]=(inputData[1+math.floor((id-101)/8)]~(2^math.mod(id-101,8)))<br/> simMTB.setInput(serverHandle,inputData)<br/>end</p>
<p><br/>function sysCall_cleanup()<br/> sim.writeCustomDataBlock(robotHandle,'@tmpMTBSERVERHANDLE',nil)<br/> if serverHandle&gt;=0 then<br/> simMTB.stopServer(serverHandle)<br/> end<br/> removeUi()<br/>end</p>
<p>function sysCall_actuation()<br/> displayUiIfNeeded()<br/> -- Following section is where the script is communicating with the extension module:<br/> -- #################################################################################<br/> if MTBModuleFound and serverHandle&gt;=0 then<br/> if (robotProgramExecutionState&gt;0) then<br/> dt=sim.getSimulationTimeStep()<br/> if (robotProgramExecutionState==2) then dt=0 end -- When pausing, we simply set dt to zero!<br/> <br/> if (restarting) then<br/> -- Reset the robot and interpreter:<br/> simMTB.stopServer(serverHandle)<br/> serverHandle=startRobotServer(robotHandle,program,{0,0,0,0},{0.1,0.4})<br/> restarting=false<br/> else<br/> -- Handle the robot program (simMTB.run is a custom Lua command defined in the simExtMtb.dll extension module):<br/> result,cmdMessage,newJointPositions=simMTB.step(serverHandle,dt)<br/> if (result~=-1) then<br/> -- program executes fine<br/> -- Read the joint values and the robot's output (simMTB.getJoints and simMTB.getOutput are custom Lua command defined in the simExtMtb.dll extension module):<br/> jointPositions=simMTB.getJoints(serverHandle)<br/> outputData=simMTB.getOutput(serverHandle)<br/> if (result==1) then<br/> -- program end<br/> robotProgramExecutionState=0<br/> restarting=true<br/> cmdMessage=''<br/> end<br/> end<br/> end<br/> end<br/> <br/> -- Read the robot's input (simMTB.getInput is a custom Lua command defined in the simExtMtb.dll extension module):<br/> inputData=simMTB.getInput(serverHandle)<br/> end<br/> -- ---------------------------------------------------------------------------------<br/> <br/> -- Report the new joint positions to the MTB robot:<br/> for i=1,4,1 do<br/> sim.setJointPosition(jointHandles[i],jointPositions[i])<br/> end<br/> <br/> updateUiIfNeeded()<br/>end</p><br />STL << <a href='STL.html'>Previous</a> <a href='樹狀圖.html'>Next</a> >> 樹狀圖</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        